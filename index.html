<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <meta name="robots" content="noindex, nofollow" />

  <title>Ascension Check-In/Out</title>

  <script src="https://cdn.tailwindcss.com"></script>

  <link rel="manifest" href="manifest.json" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <script type="module" src="main.js"></script>

  <style type="text/tailwindcss">
    body {
      margin: 0;
      padding-top: env(safe-area-inset-top);
      padding-right: env(safe-area-inset-right);
      padding-bottom: env(safe-area-inset-bottom);
      padding-left: env(safe-area-inset-left);
      min-height: 100vh;
      box-sizing: border-box;
    }
  </style>
</head>

<body class="bg-gray-50 text-gray-800 font-sans">

  <!-- ======================
            LOGIN SCREEN     
       ====================== -->
  <div id="login-screen" class="min-h-[100vh] flex items-center justify-center px-4">
    <div class="w-full max-w-sm bg-white rounded-xl shadow-lg p-6 space-y-6">
      <h1 class="text-3xl font-semibold text-center text-gray-900">Ascension<br>Aftercare Login</h1>

      <form id="login-form" class="space-y-4">
        <label class="block text-sm font-medium text-gray-700 text-center">Enter your PIN</label>
        <input type="password" id="pin-input" name="pin" minlength="4" maxlength="4" pattern="\d*" inputmode="numeric"
          class="mt-1 block w-full px-4 py-3 text-center border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring focus:border-blue-500 text-lg"
          required />

        <p id="login-error" class="text-sm text-red-600 text-center hidden">Invalid PIN. Please try again.</p>

        <button type="submit" id="login-button"
          class="w-full py-3 px-4 bg-emerald-600 text-white font-semibold rounded-lg hover:bg-emerald-700 transition">
          Log In
        </button>
      </form>
    </div>
  </div>

  <!-- ======================
            MAIN SCREEN     
       ====================== -->
  <div id="main-screen" class="screen hidden py-8">
    <div class="max-w-7xl mx-auto px-4 space-y-6">

      <!-- ROLE + LOGOUT -->
      <div class="flex justify-end items-center gap-4 text-gray-700 text-base">
        <div id="user-role-display" class="font-medium"></div>
        <button id="logout-button"
          class="px-3 py-2 text-red-500 bg-white rounded-lg hover:text-red-600 hover:bg-gray-100 transition">
          Logout
        </button>
      </div>

      <!-- CHECK-IN / CHECK-OUT CARDS -->
      <div class="grid grid-cols-1 gap-4 lg:grid-cols-2">

        <!-- Check-In Card -->
        <section id="check-in-card" class="bg-gray-50 rounded-lg p-4">
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Checked-Out</h2>

          <div class="bg-white rounded-lg shadow-md p-4 transition-transform hover:scale-[1.01]">
            <div id="check-in-select-all-wrapper" class="mb-2 hidden">
              <label
                class="flex items-center space-x-3 py-3 pr-3 cursor-pointer text-base rounded-lg hover:bg-gray-100 transition-colors duration-150 select-none">
                <input type="checkbox" id="check-in-select-all" class="sr-only peer" />
                <span
                  class="relative flex-shrink-0 w-7 h-7 md:w-6 md:h-6 rounded-lg border border-gray-300 flex items-center justify-center transition-all duration-200 peer-checked:bg-emerald-600 peer-checked:border-emerald-600 hover:border-gray-400 hover:bg-gray-50 shadow-sm [&>svg]:opacity-0 [&>svg]:scale-75 [&>svg]:transition-all [&>svg]:duration-200 peer-checked:[&>svg]:opacity-100 peer-checked:[&>svg]:scale-100">
                  <svg class="w-4 h-4 text-white stroke-2" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </span>
                <span class="font-semibold">Select All</span>
              </label>
            </div>
            <div id="check-in-list" class="space-y-2 max-h-96 overflow-y-auto">
            </div>
          </div>

          <div class="mt-4">
            <small id="check-in-message" class="block text-sm text-gray-600 italic mb-5">Select student(s) to check
              in.</small>

            <button id="submit-check-in"
              class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition hidden">
              Check In Selected
            </button>
          </div>

        </section>

        <!-- Check-Out Card -->
        <section id="check-out-card" class="bg-gray-50 rounded-lg p-4">
          <h2 class="text-3xl font-bold text-gray-900 mb-2">Checked-In</h2>

          <div class="bg-white rounded-lg shadow-md p-4 transition-transform hover:scale-[1.01]">
            <div id="check-out-select-all-wrapper" class="mb-2 hidden">
              <label
                class="flex items-center space-x-3 py-3 pr-3 cursor-pointer text-base rounded-lg hover:bg-gray-100 transition-colors duration-150 select-none">
                <input type="checkbox" id="check-in-select-all" class="sr-only peer" />
                <span
                  class="relative flex-shrink-0 w-7 h-7 md:w-6 md:h-6 rounded-lg border border-gray-300 flex items-center justify-center transition-all duration-200 peer-checked:bg-emerald-600 peer-checked:border-emerald-600 hover:border-gray-400 hover:bg-gray-50 shadow-sm [&>svg]:opacity-0 [&>svg]:scale-75 [&>svg]:transition-all [&>svg]:duration-200 peer-checked:[&>svg]:opacity-100 peer-checked:[&>svg]:scale-100">
                  <svg class="w-4 h-4 text-white stroke-2" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                  </svg>
                </span>
                <span class="font-semibold">Select All</span>
              </label>
            </div>
            <div id="check-out-list" class="space-y-2 max-h-96 overflow-y-auto">
            </div>
          </div>

          <div class="mt-4">
            <small id="check-out-message" class="block text-sm text-gray-600 italic mb-5">Select student(s) to check
              out.</small>

            <button id="submit-check-out"
              class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition hidden">
              Check Out Selected
            </button>
          </div>
        </section>

      </div>

      <hr>

      <!-- ADMIN SECTION -->
      <div id="admin-section" class="hidden space-y-6">

        <!-- USER MANAGEMENT -->
        <section id="user-management" class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <div>
              <h2 id="users-heading" class="inline text-3xl font-bold text-gray-900 cursor-pointer">Users</h2>
              <div class="inline text-sm text-gray-500 italic ml-2">Click to show/hide.</div>
            </div>
            <button id="add-user-button"
              class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition">Add User</button>
          </div>
          <select id="users-sort" class="px-2 py-1 border rounded mb-2">
            <option value="last_name-asc">Last Name ↑</option>
            <option value="last_name-desc">Last Name ↓</option>
            <option value="first_name-asc">First Name ↑</option>
            <option value="first_name-desc">First Name ↓</option>
            <option value="role-asc">Role ↑</option>
            <option value="role-desc">Role ↓</option>
          </select>
          <div id="users-container" class="space-y-2"></div>
        </section>

        <hr>

        <!-- STUDENT ROSTER -->
        <section id="student-roster" class="bg-gray-50 rounded-lg p-4">
          <div class="flex items-center justify-between mb-2">
            <div class="flex flex-col md:block">
              <h2 id="students-heading" class="inline text-3xl font-bold text-gray-900 cursor-pointer">Students</h2>
              <div class="inline text-sm text-gray-500 italic md:ml-2">Click to show/hide.</div>
            </div>
            <button id="add-student-button"
              class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition">Add
              Student</button>
          </div>
          <select id="students-sort" class="px-2 py-1 border rounded mb-2">
            <option value="last_name-asc">Last Name ↑</option>
            <option value="last_name-desc">Last Name ↓</option>
            <option value="first_name-asc">First Name ↑</option>
            <option value="first_name-desc">First Name ↓</option>
            <option value="grade-asc">Grade ↑</option>
            <option value="grade-desc">Grade ↓</option>
          </select>
          <div id="students-container" class="space-y-2"></div>
        </section>

        <hr>

        <!-- ATTENDANCE FEED -->
        <section id="attendance-feed" class="bg-gray-50 rounded-lg p-4">
          <div class="flex flex-col justify-between md:flex-row">
            <div class="mb-2">
              <h2 id="attendance-heading" class="inline text-3xl font-bold text-gray-900 cursor-pointer">Attendance
              </h2>
              <div class="inline text-sm text-gray-500 italic ml-2">Click to show/hide.</div>
            </div>
            <div id="attendance-buttons"
              class="flex flex-col justify-between items-start md:space-x-2 md:flex-row md:items-center">
              <button id="download-raw"
                class="px-4 py-2 mb-2 bg-emerald-600 text-white border-2 border-emerald-600 rounded-lg hover:bg-emerald-700 hover:border-emerald-700 transition">Download
                Raw</button>
              <button id="download-compressed"
                class="px-4 py-2 mb-2 bg-white text-emerald-600 border-2 border-emerald-600 rounded-lg hover:bg-emerald-50 hover:text-emerald-700 hover:border-emerald-700 transition">Download
                Compressed</button>
            </div>
          </div>

          <div id="attendance-filters"
            class="flex flex-col flex-wrap gap-2 items-start mb-4 md:items-center md:flex-row">
            <input id="attendance-search" type="text" placeholder="Search student..."
              class="px-2 py-1 border rounded" />
            <div>
              <label for="attendance-start-date">Start Date:</label>
              <input id="attendance-start-date" type="date" class="px-2 py-1 border rounded" />
            </div>
            <div>
              <label for="attendance-end-date">End Date:</label>
              <input id="attendance-end-date" type="date" class="px-2 py-1 border rounded" />
            </div>
            <select id="attendance-action" class="px-2 py-1 border rounded">
              <option value="">All Actions</option>
              <option value="in">Check In</option>
              <option value="out">Check Out</option>
            </select>
          </div>

          <div id="attendance-wrapper"
            class="bg-white rounded-lg shadow-md p-5 transition-transform hover:scale-[1.01]">
            <div id="attendance-container" class=" overflow-y-auto max-h-[40rem] divide-y">
            </div>
          </div>
          <details id="attendance-bulk-delete-wrapper" class="py-2 text-sm text-gray-400">
            <summary class="cursor-pointer">Clear Logs</summary>
            <label for="attendance-bulk-delete-date">Delete logs older than:</label>
            <input type="date" id="attendance-bulk-delete-date" class="px-2 py-1 border rounded" />
            <button id="attendance-bulk-delete"
              class="px-2 py-1 mb-2 bg-white text-red-600 border border-red-500 rounded-lg hover:bg-red-50 hover:text-red-600 hover:border-red-600 transition">Delete
              Logs</button>
          </details>
        </section>

      </div>

    </div>
  </div>

  <!-- ======================
             USER MODAL      
       ====================== -->
  <div id="user-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-40">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl mx-4 shadow-lg">
      <h3 id="user-modal-title" class="text-xl font-semibold mb-4 text-gray-900">Add New User</h3>
      <form id="user-form" class="grid grid-cols-1 gap-4">

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="user-first-name" class="block font-medium mb-1">First Name</label>
            <input type="text" id="user-first-name" name="first_name"
              class="w-full border border-gray-300 rounded px-3 py-2" required />
          </div>
          <div>
            <label for="user-last-name" class="block font-medium mb-1">Last Name</label>
            <input type="text" id="user-last-name" name="first_name"
              class="w-full border border-gray-300 rounded px-3 py-2" required />
          </div>
          <div>
            <label for="user-role" class="block font-medium mb-1">Role</label>
            <select id="user-role" name="role" class="w-full border border-gray-300 rounded px-3 py-2" required>
              <option value="" disabled selected>Select role</option>
              <option value="admin">Admin</option>
              <option value="teacher">Teacher</option>
              <option value="parent">Parent</option>
            </select>
          </div>
        </div>

        <div>
          <label for="user-pin" class="block font-medium mb-1">PIN</label>
          <input type="text" id="user-pin" name="pin" minlength="4" maxlength="4" pattern="\d*" inputmode="numeric"
            required class="w-full border border-gray-300 rounded px-3 py-2" />
        </div>

        <div class="w-full max-w-md">
          <label for="student-picker-input" class="block font-medium mb-1">Assign Student(s)</label>
          <div id="student-picker"
            class="relative border border-gray-300 rounded px-2 py-1 min-h-[44px] flex flex-wrap gap-2 items-center cursor-text">
            <input id="student-picker-input" placeholder="Type to search..."
              class="flex-1 min-w-[80px] border-none outline-none py-1" />
            <div id="student-suggestions" class="absolute top-full left-0 w-full bg-white border rounded z-10 hidden">
            </div>
          </div>
        </div>

        <div class="flex justify-end gap-2 mt-2">
          <button type="button" id="user-cancel-button"
            class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
        </div>

      </form>
    </div>
  </div>

  <!-- ======================
           STUDENT MODAL    
       ====================== -->
  <div id="student-modal" class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 hidden z-40">
    <div class="bg-white rounded-xl p-6 w-96 max-w-full mx-4 shadow-lg">
      <h3 id="student-modal-title" class="text-lg font-semibold mb-4 text-gray-900">Add Student</h3>
      <form id="student-form" class="space-y-4">
        <div>
          <label class="block font-medium mb-1">Last Name</label>
          <input id="student-last-name" name="last_name" class="w-full border border-gray-300 rounded px-3 py-2"
            required />
        </div>
        <div>
          <label class="block font-medium mb-1">First Name</label>
          <input id="student-first-name" name="first_name" class="w-full border border-gray-300 rounded px-3 py-2"
            required />
        </div>
        <div>
          <label class="block font-medium mb-1">Grade</label>
          <input id="student-grade" name="grade" class="w-full border border-gray-300 rounded px-3 py-2" />
        </div>

        <div class="flex justify-end space-x-2">
          <button type="button" id="student-cancel-button"
            class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400">Cancel</button>
          <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>

</body>

</html>